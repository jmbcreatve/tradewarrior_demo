# TradeWarrior Log

This file is a terse, chronological log of important decisions and milestones.  
Each line should be one clear event; details belong in commits and TW_CANON.md.

---

- 2025-11-26 – Initialized TradeWarrior repo, added gitignore and removed pycache.  
- 2025-11-30 – Added Hyperliquid adapters (placeholders), refactored data routing, and cleaned up stray SSH config and state/log files.  
- 2025-12-01 – Completed initial HL refactor: introduced risk envelope, replay execution adapter, and expanded tests for replay and risk engine.  
- 2025-12-01 – Phase 1 spine hardening commit: added run_id/snapshot_id, improved logging, and replay exports.  
- 2025-12-02 – Fixed broken local environment by restoring `config.py` and getting pytest to collect tests cleanly again.  
- 2025-12-02 – Created TW_CANON.md and TW_LOG.md as the canonical truth layer for TradeWarrior.  
- 2025-12-02 – Entered Phase 2 (GPT Policy + Risk Brain v1) and defined v1 contracts.  
- 2025-12-02 – Fixed test_gatekeeper assertions to match dict return type.  
- 2025-12-03 – Updated requirements, improved logging, and added testnet configuration support (load_testnet_config, run_testnet.py, state_testnet.json).  
- 2025-12-03 – Enhanced config.py with testnet mode, env file loading, initial_equity support, and improved state_memory.py schema handling.
- 2025-12-03 – Enhanced liquidity context computation: replaced placeholder with fractal swing point detection (swing highs/lows) and integration with microstructure shapes (equal-high/low clusters, sweeps). Added market session classification (ASIA/EUROPE/US/OFF_HOURS based on UTC hour) and enhanced timing_state to return both session label and TimingState enum. Added market_session field to snapshot schema.
- 2025-12-03 – Fixed GPT rationale/notes consistency: updated gpt_client.py to parse "rationale" field from GPT JSON response (as per brain.txt), with fallback to "notes" for backward compatibility. Verified end-to-end flow: GPT rationale → GptDecision.notes → state["gpt_state_note"] → next snapshot. Added tests to verify rationale flows correctly through the pipeline.
- 2025-12-03 – Implemented time-based market session classification for timing_state: replaced always-NORMAL timing_state with session-aware classification. Added _classify_market_session() to classify UTC timestamps into ASIA (00:00-08:00), EUROPE (07:00-16:00), US (13:00-22:00), and OFF_HOURS (22:00-00:00) with overlap priority US > EUROPE > ASIA. Updated _compute_timing_state() to map sessions to TimingState enum: OFF_HOURS→AVOID, ASIA→CAUTIOUS, EUROPE/US→NORMAL. Snapshot now includes both market_session (raw label) and timing_state (enum) for GPT. Added comprehensive tests covering all sessions, overlap handling, and timing state mapping verification.
- 2025-12-03 – Enhanced gatekeeper with slow trend timeout: added MIN_SECONDS_FOR_SLOW_TREND_CALL (900s/15min) and MIN_SHAPE_SCORE_FOR_SLOW_TREND (0.2) to address "silent in slow trend" problem. Gatekeeper now allows GPT calls when time since last GPT >= 15 minutes and there's some drift (price_change >= MIN_ABS_PRICE_PCT) or shape bias (shape_score >= 0.2), even if price move is below normal threshold. Rate limits (12 calls/hour, 60s spacing) remain enforced. Added tests for slow trend timeout triggering and rate limit enforcement.
- 2025-12-03 – Enhanced risk envelope audit logging: updated risk_engine.py and execution_engine.py to log full risk_envelope (including note field showing tightening reasons like "trim_for_vol", "timing_cautious") and complete RiskDecision details (size, leverage, stop distances) in structured format for every approved trade. Risk envelope is now stored in state for execution logging. Added tests to verify logs contain both risk_envelope and risk_decision info for approved trades, enabling easy audit of risk envelope behavior during testnet runs.
- 2025-12-03 – Implemented HyperliquidTestnetExecutionAdapter: replaced placeholder with real testnet order placement using Hyperliquid Python SDK. Adapter places market orders only, respects RiskDecision parameters (size, leverage, stop/take), handles errors gracefully (returns "no_trade" instead of throwing), and only activates when ExecutionMode.HL_TESTNET is explicitly set. Reads credentials from HL_TESTNET_MAIN_WALLET_ADDRESS and HL_TESTNET_API_WALLET_PRIVATE_KEY env vars. Updated data_router.py to only add adapter in testnet mode with health check. Added comprehensive unit tests with mocked SDK and integration tests behind RUN_HL_INTEGRATION_TESTS flag. Default demos continue using mock execution for safety.
- 2025-12-03 – Synced VPS (phase3-node) → GitHub → local: committed and pushed all changes from phase3-node to main branch (17 files changed, including Hyperliquid execution adapter tests and various core module updates).
